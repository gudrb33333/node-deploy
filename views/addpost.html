{% extends 'layout.html' %}

{% block content %}
<div>
    <form id="card-form" action="/post" method="post" enctype="multipart/form-data">
      <div class="input-group">
        <textarea id="card" name="content" maxlength="140"></textarea>
      </div>
      <div class="img-preview">
        
      </div>
      <div>
        <label id="img-label" for="img">사진 업로드</label>
        <input id="img" type="file" accept="image/*" attachId="{{card.img}}" multiple>
        <button id="card-btn" type="submit" class="btn">짹짹</button>
      </div>
    </form>
  </div>
{% endblock %}


{% block script %}
  <script>
      if (document.getElementById('img')) {
      document.getElementById('img').addEventListener('change', function(e) {
        const formData = new FormData();
        console.log(this, this.files);
        for(var i=0; i<this.files.length;i++){
        formData.append('img', this.files[i]);
        formData.append('attachId', this.attributes.attachId.value);
        }
        axios.post('/post/img', formData)
          .then((res) => {
            console.log(res.data);
            for(let i= 0; i<res.data.atchFileArray.length; i++){         
              let html  = "<div id=\"img-div\">";
                  html +=   "<img id=\"img-preview\" src=\""+res.data.atchFileArray[i].url+"\" style=\"display: inline;\" width=\"250\" alt=\"미리보기\">";
                  html +=   "<input id=\"img-atchFileId\" value=\""+res.data.atchFileArray[i].atchFileId+"\" type=\"hidden\" name=\"atchFileId\">";
                  html +=   "<input id=\"img-url\" value=\""+res.data.atchFileArray[i].url+"\" type=\"hidden\" name=\"url\">";
                  html +=   "<input id=\"img-fileSn\" value=\""+res.data.atchFileArray[i].fileSn+"\" type=\"hidden\" name=\"fileSn\">";
                  html += "</div>";
              $('.img-preview').append(html); 
            }
          })
          .catch((err) => {
            console.error(err);
          });
      });
    }
  </script>
{% endblock %}